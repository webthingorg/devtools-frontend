{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "3efc7808_281c2a60",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T10:55:20Z",
      "side": 1,
      "message": "Not going to leave a -1 review, because I am OOO next week and do not want to block, but please make sure the imports are updated to follow the DevTools convention before this lands. \n\nAll imports that import from a different module must use the entry point to do so. In a release build a module is bundled up to all be contained in its entry point, and hence in our code we have to follow-suit. It might work in dev (where we don\u0027t bundle) but broken imports will cause release build breakage.",
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0fbf1a98_ffa5c5fd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1378407
      },
      "writtenOn": "2024-06-21T13:24:09Z",
      "side": 1,
      "message": "I\u0027m unclear exactly what\u0027s disallowed since the linter isn\u0027t being helpful, but can we assume that if the layout tests are passing then this issue is resolved?",
      "parentUuid": "3efc7808_281c2a60",
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "33b1f183_da37ca13",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T13:33:47Z",
      "side": 1,
      "message": "See my two other comments for examples in context, but TL;DR is:\n\n1. You must import from the entry point if you are importing from another module (aka folder)\nGOOD: import * as X from \u0027./x/x.js\u0027;\nBAD: import {Something} from \u0027./x/some-sub-module.js\u0027;\n\n2. You can only import from the non-entrypoint if you are within that module\u0027s folder.\n\nSo `x/one.js` can import directly from `x/two.js`, if you want to import from `y/one.js`, you have to access it via `y/y.js` (the entrypoint)",
      "parentUuid": "0fbf1a98_ffa5c5fd",
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ba37bac_b85cf2f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1447167
      },
      "writtenOn": "2024-06-26T09:47:08Z",
      "side": 1,
      "message": "Interesting. The way it\u0027s implemented right now, all files belong to the same single build module (even if inside different folders). This allows to organize the files nicely while preventing cirular dependencies at build time when imports are added across folders. It also makes it possible for files from one folder to import files from another directly (not via a entrypoint file / bundle file).\n\nMy guess would be that this should be fine because this will all end up being bundled into lantern.js. However the devtools browser test failures seem to indicate otherwise, because they error when devtools modules are tried to be loaded in the test environment  (https://chromium-swarm.appspot.com/task?id\u003d6a6a2c02f5559710\u0026w\u003dtrue).\n\nI wonder if there\u0027s a set of imports that violates how the bundler works that we can fix easily. Otherwise, I think we would need to stick to the usual pattern of defining one entry point per folder/module (we have the `ts` entry point files but are missing the corresponding BUILD.gn file for each) and ensure we use a module\u0027s entrypoint when importing from another module. Doing this would likely cause circular dependencies so we would have to split the stuff into more submodules, which is annoying but likely needed if we don\u0027t find the culprit in the current implementation.",
      "parentUuid": "33b1f183_da37ca13",
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84d991d2_be2626bd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 9
      },
      "lineNbr": 0,
      "author": {
        "id": 1378407
      },
      "writtenOn": "2024-06-26T17:11:55Z",
      "side": 1,
      "message": "I\u0027m thinking my naming of `lowercase/lowercase.ts` files that weren\u0027t really devtools entrypoints was messing up the bundler. Perhaps it uses the file naming convention to assume things that are not codified in the BUILD files.",
      "parentUuid": "9ba37bac_b85cf2f6",
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "08ce839b_465aee57",
        "filename": "front_end/models/trace/LanternComputationData.ts",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T10:55:20Z",
      "side": 1,
      "message": "these imports don\u0027t follow the DevTools pattern (and I think will break in a release build).\n\nAny time you import a file from another module (e.g. folder) you need to use that folder\u0027s entry point (the file named the same as the folder)\n\nSo these need to be:\n\n```\nimport * as Handlers from \u0027./handlers/handlers.js\u0027\nimport * as Lantern from \u0027./lantern/lantern.js\u0027\nimport * as Types from \u0027./types/types.js\u0027\n```\n\nI am surprised the ESLint rule we have didn\u0027t detect this case.\n\nUnfortunately this does lead to more verbose code...but without this our prod bundle will likely not work.\n\n(on a separate note, I agree this file should ideally be within the lantern module. If it can\u0027t be for now, let\u0027s file a bug and try to move it in a follow-up CL)",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 18,
        "endChar": 0
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0800732_1daf0f93",
        "filename": "front_end/models/trace/LanternComputationData.ts",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T13:39:57Z",
      "side": 1,
      "message": "\"(on a separate note, I agree this file should ideally be within the lantern module. If it can\u0027t be for now, let\u0027s file a bug and try to move it in a follow-up CL)\"\n\nignore this bit, I don\u0027t think this now ðŸ˜„",
      "parentUuid": "08ce839b_465aee57",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 18,
        "endChar": 0
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f5f42124_9f5d4d2a",
        "filename": "front_end/models/trace/LanternComputationData.ts",
        "patchSetId": 9
      },
      "lineNbr": 18,
      "author": {
        "id": 1378407
      },
      "writtenOn": "2024-06-21T17:31:56Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c0800732_1daf0f93",
      "range": {
        "startLine": 13,
        "startChar": 0,
        "endLine": 18,
        "endChar": 0
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3e282a3_8056ed1c",
        "filename": "front_end/models/trace/lantern/metrics/TotalBlockingTime.ts",
        "patchSetId": 9
      },
      "lineNbr": 13,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T10:57:39Z",
      "side": 1,
      "message": "I think these imports may be problematic in DevTools too because of how release builds get bundled - these files will not exist in a release build\n\nI\u0027d suggest moving the contents of the metrics/ folder up a level (you can import files from the same folder at the same level), or putting these files into another module (lantern/core or something) to enable you to do `import * as Core from \u0027../core/core.js\u0027`\n\n(yes this frustrating...but not something that is going to change)",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 83
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "061da322_73f4c6c3",
        "filename": "front_end/models/trace/lantern/metrics/TotalBlockingTime.ts",
        "patchSetId": 9
      },
      "lineNbr": 13,
      "author": {
        "id": 1378407
      },
      "writtenOn": "2024-06-21T12:51:51Z",
      "side": 1,
      "message": "I assume this is why the layout tests are failing, but the other tests are fine in CI? I wasn\u0027t able to get an error message to debug that further.",
      "parentUuid": "a3e282a3_8056ed1c",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 83
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d22d7d7_59150f74",
        "filename": "front_end/models/trace/lantern/metrics/TotalBlockingTime.ts",
        "patchSetId": 9
      },
      "lineNbr": 13,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T12:52:48Z",
      "side": 1,
      "message": "Yeah I expect so.\n\nYou could run a release build locally and you would probably see the error if you try to run the performance panel",
      "parentUuid": "061da322_73f4c6c3",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 83
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "947467b3_47fcc48f",
        "filename": "front_end/models/trace/lantern/metrics/TotalBlockingTime.ts",
        "patchSetId": 9
      },
      "lineNbr": 13,
      "author": {
        "id": 1378407
      },
      "writtenOn": "2024-06-21T13:01:06Z",
      "side": 1,
      "message": "Release is the default right? My args.gn is empty. Not seeing any errors running DevTools locally.",
      "parentUuid": "9d22d7d7_59150f74",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 83
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b14e8b57_964a4d78",
        "filename": "front_end/models/trace/lantern/metrics/TotalBlockingTime.ts",
        "patchSetId": 9
      },
      "lineNbr": 13,
      "author": {
        "id": 1396442
      },
      "writtenOn": "2024-06-21T13:37:38Z",
      "side": 1,
      "message": "I think `is_debug` defaults to true.\n\nSo you need to do a build with is_debug \u003d false",
      "parentUuid": "947467b3_47fcc48f",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 83
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dcfae0a8_bf8c4dbf",
        "filename": "front_end/models/trace/lantern/metrics/TotalBlockingTime.ts",
        "patchSetId": 9
      },
      "lineNbr": 13,
      "author": {
        "id": 1378407
      },
      "writtenOn": "2024-06-25T17:24:05Z",
      "side": 1,
      "message": "This is resolved - layout tests are working now.\n\nNote that this file and the ones it imports are all within the same devtools module.",
      "parentUuid": "b14e8b57_964a4d78",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 83
      },
      "revId": "45460d95fa3b3135c8a2dbf681be4dae1e52e20b",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}