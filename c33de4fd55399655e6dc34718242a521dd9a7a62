{
  "comments": [
    {
      "key": {
        "uuid": "df4d9a6f_60047eeb",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2020-07-10T13:58:41Z",
      "side": 0,
      "message": "Hello Dirk,\n\nThis week, DevTools hit some build issues on Chromium `is_debug` post-commit bots. More specifically, `linux_chromium_dbg_ng` was failing, because it could not find files: https://ci.chromium.org/p/chromium/builders/ci/Linux%20Tests%20%28dbg%29%281%29/90122\n\nWe eventually triaged it to the problem that several files were not sent to the swarming bots. The fix was adding `front_end/formatter_worker/` as an explicit root dependency in https://chromium-review.googlesource.com/c/devtools/devtools-frontend/+/2287522\n\nHowever, with upcoming migrations in DevTools, we don\u0027t want to list every single target in the root BUILD.gn. Ideally, we only add `front_end` in our root deps, where `front_end` depends on `front_end/formatter_worker`.\n\nThis CL was an attempt to do so, but as you can see the `blink_light_rel` is failing. We have seen that error before and this was the fix: https://chromium-review.googlesource.com/c/devtools/devtools-frontend/+/2209101 Once again, the swarming bots were not able to find a \"dependency of a dependency\" and requires it to be a top-level dependency.\n\nIn my investigation on how this all works, I discovered https://source.chromium.org/chromium/chromium/src/+/master:BUILD.gn;l\u003d51-63;drc\u003dab6407594b6c44ea730fbfb51a3d64d25a869d54?originalUrl\u003dhttps:%2F%2Fcs.chromium.org%2F which mentions https://bugs.chromium.org/p/chromium/issues/detail?id\u003d503241 which seems very similar. However, sadly I don\u0027t understand how and why that would fix the issue, nor do I understand how we can apply it to DevTools.\n\nCould you help us out with specifying `data_deps` such that it will recursively look for relevant output files, rather than us having to specify every dependency in the root BUILD.gn?\n\nThanks in advance.",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "56ba1910_67228e06",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2020-07-10T14:32:39Z",
      "side": 0,
      "message": "I found that `:all_devtools_files` itself was using `deps`, so I changed that to `public_deps` as well. Not sure if that would fix it though, CQ is running atm.",
      "parentUuid": "df4d9a6f_60047eeb",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9b23bb4_c4611d7b",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2020-07-10T14:37:16Z",
      "side": 0,
      "message": "Yeah exactly, that didn\u0027t fix it either.",
      "parentUuid": "56ba1910_67228e06",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0aff3bf7_b50ad3fb",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1003232
      },
      "writtenOn": "2020-07-10T20:14:52Z",
      "side": 0,
      "message": "I don\u0027t know enough about how the devtools build is set up, and without spending a bunch of time on it here (which I can do, but haven\u0027t done yet), I\u0027m not sure what you\u0027re asking me.\n\nThat said, my best guess from a cursory skimming of this is that you\u0027re confusing `deps` with `data_deps`.\n\n`deps` only applies to things needed at compile time. If A has a deps entry for B, then B will be compiled before A. It has no effect at runtime.\n\nIf you need files to be shipped along at runtime, you need to specify them in `data_deps`. If A has a `data_deps` on B, then B will be compiled before A is done (though it may be compiled in parallel w/ A), and then A\u0027s isolate will include B\u0027s output files. If B depends on C, and A needs C\u0027s files as well, then declare C as a data_deps of B.\n\nThis can mean that you need to declare B as *both* a deps and a data_deps of A. This is somewhat common with group() targets in particular.\n\nHopefully this is enough of a clue to help you figure out what\u0027s going on. If it isn\u0027t -- or if you already knew this -- let me know, and I\u0027ll stare at it more closely.",
      "parentUuid": "c9b23bb4_c4611d7b",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "44423e75_4b2e7750",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2020-07-13T11:10:37Z",
      "side": 0,
      "message": "No I didn\u0027t know that and your explanation is great, thanks! I was able to create https://chromium-review.googlesource.com/c/devtools/devtools-frontend/+/2292282 with this new knowledge and it indeed passes CQ. We are going to take another good look at our targets in DevTools to make sure they are both `deps` and `data_deps` compatible.\n\nOne side-question: does `copy` automatically fix the `data` outputs? Cause we are seeing cases where `copy` magically worked (but we were unaware of it working), but some other templates we define in devtools (which don\u0027t have the `data` set correctly) would break. My current assumption is that `copy` does indeed fix `data` correctly, which explains the difference we are observing. And that in turn means that if we fix our higher-level templates to do the same, we fundamentally fix the issues we encountered.",
      "parentUuid": "0aff3bf7_b50ad3fb",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0848d715_398b4bf0",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2020-07-13T11:28:08Z",
      "side": 0,
      "message": "And only now I was able to better search the GN reference and I have found this section that basically explains it as well: https://gn.googlesource.com/gn/+/master/docs/reference.md#actions-and-copies",
      "parentUuid": "44423e75_4b2e7750",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "250106a7_0dfb9a82",
        "filename": "BUILD.gn",
        "patchSetId": 2
      },
      "lineNbr": 946,
      "author": {
        "id": 1003232
      },
      "writtenOn": "2020-07-13T17:40:55Z",
      "side": 0,
      "message": "Great. Glad it helped, and let me know if you have other questions.",
      "parentUuid": "0848d715_398b4bf0",
      "range": {
        "startLine": 945,
        "startChar": 0,
        "endLine": 946,
        "endChar": 89
      },
      "revId": "c33de4fd55399655e6dc34718242a521dd9a7a62",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}