# Copyright 2020 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("../../../scripts/build/ninja/devtools_entrypoint.gni")
import("../../../config/gni/all_devtools_files.gni")
import("../../../scripts/build/ninja/copy.gni")
import("../../../scripts/build/ninja/devtools_entrypoint.gni")
import("../../../scripts/build/ninja/devtools_pre_built.gni")
import("../visibility.gni")

_lighthouse_sources = lighthouse_locale_files + [
                        "lighthouse-tsconfig.json",
                        "lighthouse-dt-bundle.d.ts",
                      ]

copy_to_gen("lighthouse-locale-files") {
  sources = _lighthouse_sources
}

# devtools_pre_built("lighthouse-javascript-report-renderer") {
#   sources_are_release = false

#   sources = [
#     "report/util.js",
#     "report/logger.js",
#     "report/report-ui-features.js",
#     "report/details-renderer.js",
#     "report/psi.js",
#     "report/file-namer.js",
#     "report/performance-category-renderer.js",
#     "report/crc-details-renderer.js",
#     "report/report-renderer.js",
#     "report/text-encoding.js",
#     "report/dom.js",
#     "report/category-renderer.js",
#     "report/element-screenshot-renderer.js",
#     "report/i18n.js",
#     "report/pwa-category-renderer.js",
#     "report/snippet-renderer.js",
#   ]
# }

# # TODO: figure out how "save as HTML" will work
# devtools_entrypoint("standalone-report") {
#   entrypoint = "report/main.js"

#   deps = [ ":lighthouse-javascript-report-renderer" ]

#   visibility = [
#     ":*",
#     "../../panels/lighthouse/*",
#   ]
# }

# TODO remove
devtools_pre_built("lighthouse-javascript-sources-debug") {
  sources_are_release = false

  sources = [
    "report-assets/report-generator.d.ts",
    "report-assets/report-generator.js",
    "report-assets/report.d.ts", # remove i think?
    "report-assets/report.js", # remove i think?
  ]
}

copy_to_gen("lighthouse-javascript-sources-release") {
  sources = [ "lighthouse-dt-bundle.js" ]
}

group("lighthouse") {
  public_deps = [
    ":lighthouse-javascript-sources-debug",
    ":lighthouse-javascript-sources-release",
    ":lighthouse-locale-files",
    # ":lighthouse-javascript-report-renderer",
    # ":standalone-report",
  ]
  data_deps = public_deps
  metadata = {
    grd_files = get_target_outputs(":lighthouse-javascript-sources-release")
  }
}
