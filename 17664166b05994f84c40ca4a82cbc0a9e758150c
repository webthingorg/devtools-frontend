{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "226cbeee_c161915c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2021-11-17T15:33:14Z",
      "side": 1,
      "message": "So the last e2e-test failure is because when typing `let` in the console, in the test I think that is too quick and the autocompletion doesn\u0027t show up. When I do it myself, it works just fine.\n\nCould it be the case that when we instantiate the text editor, the autocompletion isn\u0027t fully hooked up yet? In this case, typing before the autocompletion logic is hooked up could mean the user doesn\u0027t see any autocompletions. When we attach the autocompletion logic, can we check whether the editor has any text edited since instantiation by the user and then show it? E.g. don\u0027t show it when we set the full text, but only when the user has actually typed something.",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e8bfd24_5ab7b12c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1520247
      },
      "writtenOn": "2021-11-17T15:38:36Z",
      "side": 1,
      "message": "Editor creation in this component is synchronous and atomic, including the autocompletion, so that shouldn\u0027t really be happening. How is the test entering text?",
      "parentUuid": "226cbeee_c161915c",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38a5da5b_4315aafb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2021-11-17T15:42:47Z",
      "side": 1,
      "message": "The test uses the `typeText` helper: https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/test/e2e/console/console-repl-mode_test.ts;l\u003d36;drc\u003d467b0b16324b77b597e69237ae934f80118e55f6 The helper calls the Puppeteer keyboard API directly to instruct the browser to press these keys in order: https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/test/shared/helper.ts;l\u003d129-132;drc\u003d227106dbf39ef4a1989379d17775f7d64d749e4f\n\nBefore that, the test waits for the console prompt to be active: https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/test/e2e/console/console-repl-mode_test.ts;l\u003d18;drc\u003d467b0b16324b77b597e69237ae934f80118e55f6 which waits for the editor to appear and also wait 50 miliseconds (which is a workaround, but that should in theory help even more here): https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/test/e2e/helpers/console-helpers.ts;l\u003d145-151;drc\u003df7c7c9271940392ba3aeb5a095dced09026fb0fc",
      "parentUuid": "4e8bfd24_5ab7b12c",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "49f77f72_ad26c8a3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1520247
      },
      "writtenOn": "2021-11-17T15:50:47Z",
      "side": 1,
      "message": "Could it be that the SDK stuff (ExecutionContext.evaluate and such) that the completion is querying hasn\u0027t initialized yet? Does, as an experiment, adding a bogus extra delay solve the failure?",
      "parentUuid": "38a5da5b_4315aafb",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "94d39c48_feddf136",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1365394
      },
      "writtenOn": "2021-11-17T15:59:14Z",
      "side": 1,
      "message": "Good question! I tried with timeouts of 500ms and 1000ms and unfortunately, that doesn\u0027t fix it. Interestingly enough, when I start the test in debug mode, don\u0027t see any output and then I type myself, it works just fine.\n\nAnother theory: could it be the case that we are typing *too quickly*? I changed the test to the following and that *does* work:\n\n```\nawait typeText(\u0027l\u0027);\nawait timeout(50);\nawait typeText(\u0027e\u0027);\nawait timeout(50);\nawait typeText(\u0027t\u0027);\nawait timeout(50);\n```\n\nSo I wonder if the autocompletion of the first letter somehow overrides the autocompletion of the third letter, because there is a text mismatch and the autocompletion was discarded?",
      "parentUuid": "49f77f72_ad26c8a3",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2b317fec_64e67f3d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1520247
      },
      "writtenOn": "2021-11-17T16:10:19Z",
      "side": 1,
      "message": "Ah, yes, I think you got it. When the full word `let` is present the first time completion opens, the syntax tree it acts on has a keyword instead of an identifier, and that throws off my implementation. I\u0027ll adjust it to also complete on alphabetic keywords.",
      "parentUuid": "94d39c48_feddf136",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2c25bbd3_34f8f5d3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1520247
      },
      "writtenOn": "2021-11-17T17:50:48Z",
      "side": 1,
      "message": "Uploaded the fix.",
      "parentUuid": "2b317fec_64e67f3d",
      "revId": "17664166b05994f84c40ca4a82cbc0a9e758150c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}