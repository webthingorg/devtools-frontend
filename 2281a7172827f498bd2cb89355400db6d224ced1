{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "769f3ade_fe96e4e7",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-18T11:43:10Z",
      "side": 0,
      "message": "Do you have details about why that does not work on MacOS?",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "90709ba7_3d29bfd5",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-18T12:17:59Z",
      "side": 0,
      "message": "The alert seems to work for consoleCleared announcement https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/front_end/panels/console/ConsoleView.ts;l\u003d1093;drc\u003de71698ba79bfda112a764e3af26414941eaafff9",
      "parentUuid": "769f3ade_fe96e4e7",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5a5e1b3_e93a6301",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-18T17:20:21Z",
      "side": 0,
      "message": "It\u0027s hard to know for sure why this sometimes happens on MacOS without debugging code for voiceOver. I\u0027ve noticed in this case where shortcut changes are applied, we do an entire refresh of the list in the `update` call with `this.list.refreshAllItems()` which fundamentally removes list elements and adds new ones to the DOM with some potential focus changes along the way. I\u0027m not sure if this disrupts the alert but then again not sure why it would work on windows and not on MacOS.\n\nThat said, I think if we can provide some visual indication of the shortcut changes which in turn offers screen reader enhancements across all platforms that would be quite valuable.",
      "parentUuid": "90709ba7_3d29bfd5",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7911639_01edcd7f",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-18T17:39:22Z",
      "side": 0,
      "message": "Thanks for clarification. We discussed it with Peter and I think we come to a conclusion that it would be probably not feasible to make all status indications visible whenever the alert does not work, it would be more interesting to fix the alert: are there are any work-arounds to try? for example, save the alert state and call it after the update is done?",
      "parentUuid": "f5a5e1b3_e93a6301",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "850a950d_17ddf11d",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-18T18:18:08Z",
      "side": 0,
      "message": "Agreed. It\u0027s not feasible to use this strategy in all places when the alert doesn\u0027t work but maybe we can review on a case-by-case basis. \n\nIn terms of workarounds, I tried your suggestion already (only call alert after update is done). I know this approach works on windows but I\u0027ll need your help verifying this on a mac. Let me know if you have access to a mac to test this and i can update the patch",
      "parentUuid": "e7911639_01edcd7f",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b7657943_661627f5",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-18T18:19:04Z",
      "side": 0,
      "message": "Yeah, I can test on a Mac",
      "parentUuid": "850a950d_17ddf11d",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52f9a94c_7c05973e",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-18T19:16:56Z",
      "side": 0,
      "message": "Awesome! Thank you. I\u0027ve updated the patch. Let me know if this works for mac as well",
      "parentUuid": "b7657943_661627f5",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "77c28db6_16ddbc20",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-18T20:36:20Z",
      "side": 0,
      "message": "So I found two things:\n\n1) settings are in a container marked as an ARIA modal dialog. The alerts are outside of the dialog and by looking in Chrome\u0027s a11y tree via the a11y tree experiment I can see that browser actually ignores those nodes, likely, because they are outside of the modal dialog. Potential solution: is to have alerts inside the dialog container.\n\n2) even if I marked the dialog as a non-modal, the alert would not be announced if I call the alert immediately, if I put it after a 5sec setTimeout then it is announced as expected. I believe this one is caused by the re-render and perhaps if there are too many things to announce some are dropped. Perhaps we need to make updates smarter to schedule the alert later.",
      "parentUuid": "52f9a94c_7c05973e",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "812aa2d7_1b056f95",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-18T22:36:14Z",
      "side": 0,
      "message": "Thanks for trying this out! Just to be sure I understand point 1) - are you saying that positioning the alert inside the settings container marked as modal dialog, would result in the announcement being made? \n\nIf this is the case, I know we hide the app-wide alert elements from the layout for some reason [here]( https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/front_end/ui/legacy/ARIAUtils.ts;l\u003d374) but maybe we can do something different with an alert element inside the modal dialog\n\nFor 2) Agreed, re-rendering can be done better but I think all the alert callsites in this patch should be after re-rendering though. So if marking the dialog as non-modal and calling the alert after re-rendering doesn\u0027t produce the announcement, I suspect there might be other factors involved here.",
      "parentUuid": "77c28db6_16ddbc20",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11d3843a_8a8463f7",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-19T06:12:27Z",
      "side": 0,
      "message": "The alert is announced if the modal attribute from the settings dialog is removed (I believe any updates to the DOM nodes outside of the modal dialog are ignored by a11y) and if you schedule an alert before or after the update with some delay, it is announced.",
      "parentUuid": "812aa2d7_1b056f95",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "18fd740b_418e3fb3",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-19T08:05:15Z",
      "side": 0,
      "message": "Here is what I mean https://chromium-review.googlesource.com/c/devtools/devtools-frontend/+/5466282 with that CL the alert already starts to show up sometimes in VoiceOver without changing the alert invocation place. Although it is still racy, sometimes this alert wins, sometimes the one caused by the DOM update in commitChanges",
      "parentUuid": "11d3843a_8a8463f7",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "69bee422_9ffb78a1",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-19T19:08:54Z",
      "side": 0,
      "message": "Thanks for clarifying. Makes sense. With regards to re-rendering, the `commitChanges` function, removes and adds shortcut changes to a setting which has a changeListener set to the `update` call. Inside the update call we always do `this.list.refreshAllItems()` to re-render the entire list which feels a bit extra when we only change a single shortcut item. Maybe we can be smarter about when we really need to referesh the entire list vs. when we just need to refresh one list item?",
      "parentUuid": "18fd740b_418e3fb3",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb038bd8_6ecc395f",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-22T07:22:14Z",
      "side": 0,
      "message": "Yes, I think if the update logic is smarter, it would be helpful for a11y announcements.",
      "parentUuid": "69bee422_9ffb78a1",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d857073_82cda893",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-22T20:32:57Z",
      "side": 0,
      "message": "Thanks. I\u0027ve updated the patch. Turns out we\u0027ve been re-rendering the full list each time we change a single shortcut inside the change listener for `userShortcutsSetting`. We really don\u0027t need to do a full update of the list. Just a single item update. And this already taken care of by calling `this.list.refreshItem(action)` within `stopEditing` when we commit changes.\n\nI also updated the alert announcements to be the localized strings. Let me know if this helps with the a11y announcements.",
      "parentUuid": "eb038bd8_6ecc395f",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b1e1ed3_09053781",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-23T08:54:13Z",
      "side": 0,
      "message": "Unfortunately, even a single DOM update highjacks the announcement: this is the announcement shown in VoiceOver https://i.imgur.com/RPh7Prc.png\n\nOnly if I delay the announcement like this\n\n```\n          setTimeout(() \u003d\u003e {\n            UI.ARIAUtils.alert(i18nString(UIStrings.shortcutChangesDiscared));\n          }, 5000)\n```\n\nit shows up reliably.",
      "parentUuid": "2d857073_82cda893",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4dc0613b_880718ee",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-23T16:22:03Z",
      "side": 0,
      "message": "Interesting. Any ideas on what could be done to improve DOM updates and fix the announcement besides the setTimeout? I\u0027m also interested in why 5000 works reliably. Is this maybe dependent on the list items?",
      "parentUuid": "3b1e1ed3_09053781",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c07f55d9_74316bfe",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-23T16:25:41Z",
      "side": 0,
      "message": "I think it is roughly for how long VoiceOver shows/announces the previous announcement. I tried with 2sec and that didn\u0027t work. Unfortunately, I do not know VoiceOver so well and for now it looks like it might be a bug in VoiceOver.",
      "parentUuid": "4dc0613b_880718ee",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "80e54476_d7abbeb6",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-23T17:56:33Z",
      "side": 0,
      "message": "Okay I\u0027m fine with using the delay for now if that works for you? I also tested on windows and narrator makes the announcement. We can follow up with a bug tracking the issue on VoiceOvera",
      "parentUuid": "c07f55d9_74316bfe",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "015dac54_1bc411fd",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-23T17:56:33Z",
      "side": 0,
      "message": "Ok",
      "parentUuid": "c07f55d9_74316bfe",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e180f27b_db2ec77e",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-23T18:08:12Z",
      "side": 0,
      "message": "I don\u0027t think we should land the delayed announcement as it might be confusing to users. At the same time, I do not have a better solution and I will need to experiment more.\n\nDoes narrator also announce the alerts/labels from the DOM update first? Or how does it handle multiple announcements?",
      "parentUuid": "80e54476_d7abbeb6",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4a1c4ff6_b5a06db6",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-23T18:47:45Z",
      "side": 0,
      "message": "Unfortunately, I could not figure out any workarounds. I guess it has something to do with live regions handling by VoiceOver. I think it is interesting to understand how other readers handle the DOM update plus an alert at the same time.",
      "parentUuid": "e180f27b_db2ec77e",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a459db29_857bf0f7",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-23T18:51:17Z",
      "side": 0,
      "message": "This is the narrator annnoucement. https://imgur.com/a/6R180dH. Hopefully the audio is clear enough.",
      "parentUuid": "4a1c4ff6_b5a06db6",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31b821ad_cb435d9c",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-23T19:05:54Z",
      "side": 0,
      "message": "Interesting, did I hear it right that it kind of puts the alert in the middle of the bullet list announcement?",
      "parentUuid": "a459db29_857bf0f7",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "271ec703_a29234ca",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-23T20:44:29Z",
      "side": 0,
      "message": "That\u0027s right. Is that what happens mac also?",
      "parentUuid": "31b821ad_cb435d9c",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3abe1342_e905be48",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-24T06:23:23Z",
      "side": 0,
      "message": "VoiceOver does not do it, it takes one announcement and pronounces only it.",
      "parentUuid": "271ec703_a29234ca",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79337b5b_1ff690ea",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1554938
      },
      "writtenOn": "2024-04-24T17:04:12Z",
      "side": 0,
      "message": "Do you think that\u0027s something that should be fixed in VoiceOver or on the devtools side? I\u0027m wonder if experimenting with focus changes might get VoiceOver to work?",
      "parentUuid": "3abe1342_e905be48",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "adcef82f_f2440fab",
        "filename": "front_end/panels/settings/KeybindsSettingsTab.ts",
        "patchSetId": 4
      },
      "lineNbr": 573,
      "author": {
        "id": 1410814
      },
      "writtenOn": "2024-04-25T08:30:33Z",
      "side": 0,
      "message": "I will try to reach to some a11y experts and report back.",
      "parentUuid": "79337b5b_1ff690ea",
      "revId": "2281a7172827f498bd2cb89355400db6d224ced1",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}